<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»å­åŒ–è²»ç”¨å ±éŠ·èˆ‡å¯©æ‰¹ç³»çµ± (é™„é›»å­éƒµä»¶é€šçŸ¥æ¨¡æ“¬)</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* è‡ªè¨‚ Scrollbar */
        .scrollable-list::-webkit-scrollbar { width: 8px; }
        .scrollable-list::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 4px; }
        .scrollable-list::-webkit-scrollbar-track { background-color: #e5e7eb; }
    </style>
    <!-- è¼‰å…¥ Google Icons for UI elements -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>

    <!-- ä¸»å®¹å™¨ -->
    <div id="app" class="min-h-screen p-4 sm:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900 border-b-4 border-indigo-600 pb-2 inline-block">
                è²»ç”¨å ±éŠ·èˆ‡å¯©æ‰¹ä¸­å¿ƒ
            </h1>
            
            <!-- è§’è‰²åˆ‡æ›æ¨¡æ“¬ -->
            <div class="mt-4 flex flex-col sm:flex-row sm:items-center justify-between bg-white p-3 rounded-xl shadow-md border-l-4 border-orange-500">
                <p class="text-sm text-gray-700 font-medium mb-2 sm:mb-0">
                    <span class="material-icons text-lg align-middle mr-1 text-orange-600">person</span>
                    ç•¶å‰æ¨¡æ“¬è§’è‰²: <span id="current-role-display" class="font-bold text-lg text-indigo-700">æäº¤è€… (å“¡å·¥)</span>
                </p>
                <div class="flex space-x-2">
                    <button onclick="switchRole('submitter')" class="role-btn bg-indigo-500 hover:bg-indigo-600 text-white text-sm py-2 px-4 rounded-lg transition duration-200 shadow">
                        åˆ‡æ›ç‚º æäº¤è€… (å“¡å·¥)
                    </button>
                    <button onclick="switchRole('approver')" class="role-btn bg-green-500 hover:bg-green-600 text-white text-sm py-2 px-4 rounded-lg transition duration-200 shadow">
                        åˆ‡æ›ç‚º å¯©æ‰¹è€… (ç¶“ç†)
                    </button>
                </div>
        </header>

        <!-- æ‡‰ç”¨ç¨‹å¼ä¸»é«”ï¼šæ ¹æ“šè§’è‰²å‹•æ…‹èª¿æ•´ä½ˆå±€ -->
        <div id="main-content" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- å ±éŠ·å–®æäº¤å€ (åƒ…æäº¤è€…é¡¯ç¤º) -->
            <div id="submission-area" class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center">
                    <span class="material-icons mr-2 text-2xl">add_box</span> æäº¤æ–°çš„å ±éŠ·å–®
                </h2>
                <form id="expense-form" class="space-y-4">
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700">è²»ç”¨èªªæ˜ (å¿…å¡«)</label>
                        <input type="text" id="description" placeholder="ä¾‹å¦‚ï¼šå®¢æˆ¶é¤è²»æˆ–å°ˆæ¡ˆå·®æ—…è²»" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </div>

                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700">æœƒè¨ˆç§‘ç›® (å¿…é¸)</label>
                        <select id="category" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                            <option value="" disabled selected>è«‹é¸æ“‡ä¸€å€‹ç§‘ç›®</option>
                            <option value="æ—…è²»åŠäº¤é€šè²»">æ—…è²»åŠäº¤é€šè²» (Travel)</option>
                            <option value="é¤è²»åŠæ‹›å¾…è²»">é¤è²»åŠæ‹›å¾…è²» (Meals)</option>
                            <option value="è¾¦å…¬ç”¨å“">è¾¦å…¬ç”¨å“ (Office Supplies)</option>
                            <option value="è¡ŒéŠ·èˆ‡å»£å‘Šè²»">è¡ŒéŠ·èˆ‡å»£å‘Šè²» (Marketing)</option>
                            <option>å…¶ä»–</option>
                        </select>
                    </div>

                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700">é‡‘é¡ (å¿…å¡«)</label>
                        <input type="number" id="amount" placeholder="ä¾‹å¦‚ï¼š1500" required min="0.01" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </div>
                    
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700">ç™¼ç”Ÿæ—¥æœŸ (å¿…å¡«)</label>
                        <input type="date" id="date" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </div>
                    
                    <button type="submit" id="submit-button" class="w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                        <span class="material-icons mr-1 text-base">send</span> æäº¤å ±éŠ·
                    </button>
                    <p id="submission-message" class="text-sm text-center mt-2 hidden"></p>
                </form>
            </div>

            <!-- å ±éŠ·å–®åˆ—è¡¨å€ (æ ¹æ“šè§’è‰²èª¿æ•´å¯¬åº¦) -->
            <div id="list-area" class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="list-title" class="text-xl font-semibold text-green-700 flex items-center">
                        <span class="material-icons mr-2 text-2xl">list_alt</span> å¾…è™•ç†èˆ‡æ­·å²å ±éŠ·å–®
                    </h2>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»å­åŒ–è²»ç”¨å ±éŠ·èˆ‡åˆ†æç³»çµ± (D3.js æ•¸æ“šå ±è¡¨)</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ D3.js for Data Visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* è‡ªè¨‚ Scrollbar */
        .scrollable-list::-webkit-scrollbar { width: 8px; }
        .scrollable-list::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 4px; }
        .scrollable-list::-webkit-scrollbar-track { background-color: #e5e7eb; }

        /* UI å„ªåŒ–ï¼šè‡ªè¨‚é€šçŸ¥æ¡†çš„è½‰æ›æ•ˆæœï¼Œè®“å®ƒæ»‘å…¥æ»‘å‡ºæ›´æµæš¢ */
        .notification-hidden { opacity: 0; transform: translateY(100%); visibility: hidden; }
        .notification-visible { opacity: 1; transform: translateY(0); visibility: visible; }
        
        /* ç¢ºä¿ SVG å®¹å™¨çš„å°ºå¯¸å’ŒéŸ¿æ‡‰æ€§ */
        #bar-chart-container {
            width: 100%;
            height: 500px; /* å›ºå®šé«˜åº¦ï¼Œå…§å®¹è‡ªå‹•èª¿æ•´å¯¬åº¦ */
            overflow-x: auto;
        }
        
        /* D3 åœ–è¡¨æ¨£å¼ */
        .bar {
            fill: #4c51bf; /* Indigo-600 */
            transition: fill 0.3s ease;
        }
        .bar:hover {
            fill: #374151; /* Gray-700 */
        }
    </style>
    <!-- è¼‰å…¥ Google Icons for UI elements -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>

    <!-- ä¸»å®¹å™¨ -->
    <div id="app" class="min-h-screen p-4 sm:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900 border-b-4 border-indigo-600 pb-2 inline-block">
                è²»ç”¨å ±éŠ·èˆ‡åˆ†æç³»çµ±
            </h1>
            
            <!-- è§’è‰²åˆ‡æ›æ¨¡æ“¬ -->
            <div class="mt-4 flex flex-col sm:flex-row sm:items-center justify-between bg-white p-3 rounded-xl shadow-md border-l-4 border-orange-500">
                <p class="text-sm text-gray-700 font-medium mb-2 sm:mb-0">
                    <span class="material-icons text-lg align-middle mr-1 text-orange-600">person</span>
                    ç•¶å‰æ¨¡æ“¬è§’è‰²: <span id="current-role-display" class="font-bold text-lg text-indigo-700">æäº¤è€… (å“¡å·¥)</span>
                </p>
                <div class="flex space-x-2">
                    <button onclick="switchRole('submitter')" class="role-btn bg-indigo-500 hover:bg-indigo-600 text-white text-sm py-2 px-4 rounded-lg transition duration-200 shadow">
                        åˆ‡æ›ç‚º æäº¤è€… (å“¡å·¥)
                    </button>
                    <button onclick="switchRole('approver')" class="role-btn bg-green-500 hover:bg-green-600 text-white text-sm py-2 px-4 rounded-lg transition duration-200 shadow">
                        åˆ‡æ›ç‚º å¯©æ‰¹è€… (ç¶“ç†)
                    </button>
                </div>
            </div>
            
            <!-- è¦–åœ–åˆ‡æ›æ¨™ç±¤ -->
            <div class="mt-6 flex space-x-3 border-b border-gray-300">
                <button id="tab-dashboard" onclick="switchView('dashboard')" 
                        class="px-4 py-2 text-sm font-medium border-b-2 border-indigo-600 text-indigo-600 transition duration-150 flex items-center">
                    <span class="material-icons mr-1">paid</span> å ±éŠ·èˆ‡å¯©æ‰¹
                </button>
                <button id="tab-analysis" onclick="switchView('analysis')" 
                        class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:border-gray-400 hover:text-gray-700 transition duration-150 flex items-center">
                    <span class="material-icons mr-1">insights</span> æœƒè¨ˆç§‘ç›®åˆ†æ (å ±è¡¨)
                </button>
            </div>
        </header>

        <!-- å ±éŠ·/å¯©æ‰¹å„€è¡¨æ¿ (Dashboard View) -->
        <div id="dashboard-panel">
            <div id="main-content" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- å ±éŠ·å–®æäº¤å€ (åƒ…æäº¤è€…é¡¯ç¤º) -->
                <div id="submission-area" class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit">
                    <h2 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center">
                        <span class="material-icons mr-2 text-2xl">add_box</span> æäº¤æ–°çš„å ±éŠ·å–®
                    </h2>
                    <form id="expense-form" class="space-y-4">
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">è²»ç”¨èªªæ˜ (å¿…å¡«)</label>
                            <input type="text" id="description" placeholder="ä¾‹å¦‚ï¼šå®¢æˆ¶é¤è²»æˆ–å°ˆæ¡ˆå·®æ—…è²»" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        </div>

                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-700">æœƒè¨ˆç§‘ç›® (å¿…é¸)</label>
                            <select id="category" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                                <option value="" disabled selected>è«‹é¸æ“‡ä¸€å€‹ç§‘ç›®</option>
                                
                                <!-- ğŸ’¼ æ—…è²»åŠäº¤é€šè²» (Travel & Transport) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ’¼ æ—…è²»åŠäº¤é€šè²» (Travel & Transport)">
                                    <option value="åœ‹å…§å·®æ—…è²»">åœ‹å…§å·®æ—…è²» (Domestic)</option>
                                    <option value="åœ‹å¤–å·®æ—…è²»">åœ‹å¤–å·®æ—…è²» (International)</option>
                                    <option value="å¸‚å€äº¤é€šè²»">å¸‚å€äº¤é€šè²» (Local Transit)</option>
                                    <option value="é«˜éµ/ç«è»Šç¥¨">é«˜éµ/ç«è»Šç¥¨ (Rail Fare)</option>
                                    <option value="æ©Ÿç¥¨è²»ç”¨">æ©Ÿç¥¨è²»ç”¨ (Airfare)</option>
                                    <option value="ä½å®¿è²»ç”¨">ä½å®¿è²»ç”¨ (Accommodation)</option>
                                </optgroup>
                                
                                <!-- ğŸ½ï¸ é¤è²»åŠæ‹›å¾…è²» (Meals & Entertainment) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ½ï¸ é¤è²»åŠæ‹›å¾…è²» (Meals & Entertainment)">
                                    <option value="å®¢æˆ¶æ‹›å¾…è²»">å®¢æˆ¶æ‹›å¾…è²» (Client Entertainment)</option>
                                    <option value="å“¡å·¥ç¦åˆ©é¤è²»">å“¡å·¥ç¦åˆ©é¤è²» (Staff Welfare)</option>
                                    <option value="å…§éƒ¨æœƒè­°é¤é£²">å…§éƒ¨æœƒè­°é¤é£² (Internal Meeting F&B)</option>
                                </optgroup>
                                
                                <!-- ğŸ“¦ è¾¦å…¬èˆ‡è¡Œæ”¿è²» (Office & Admin) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ“¦ è¾¦å…¬èˆ‡è¡Œæ”¿è²» (Office & Admin)">
                                    <option value="è¾¦å…¬ç”¨å“åŠè€—æ">è¾¦å…¬ç”¨å“åŠè€—æ (Supplies)</option>
                                    <option value="éƒµé›»/é€šè¨Šè²»">éƒµé›»/é€šè¨Šè²» (Post & Telecom)</option>
                                    <option value="ç§Ÿé‡‘æ”¯å‡º">ç§Ÿé‡‘æ”¯å‡º (Rent Expense)</option>
                                    <option value="æ°´é›»ç“¦æ–¯è²»">æ°´é›»ç“¦æ–¯è²» (Utilities)</option>
                                    <option value="ä¿®ç¹•èˆ‡ç¶­è­·è²»">ä¿®ç¹•èˆ‡ç¶­è­·è²» (Repair & Maint.)</option>
                                    <option value="å ±ç« é›œèªŒè¨‚é–±è²»">å ±ç« é›œèªŒè¨‚é–±è²» (Subscriptions)</option>
                                </optgroup>
                                
                                <!-- ğŸ’» è³‡è¨Šèˆ‡è»Ÿé«”è²» (IT & Software) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ’» è³‡è¨Šèˆ‡è»Ÿé«”è²» (IT & Software)">
                                    <option value="è»Ÿé«”è¨‚é–±è²»">è»Ÿé«”è¨‚é–±è²» (Software Subscription)</option>
                                    <option value="ç¡¬é«”æ¡è³¼è²»">ç¡¬é«”æ¡è³¼è²» (Hardware Purchase)</option>
                                    <option value="è³‡è¨Šæœå‹™è²»">è³‡è¨Šæœå‹™è²» (IT Services)</option>
                                    <option value="é›²ç«¯æœå‹™è²»">é›²ç«¯æœå‹™è²» (Cloud Services)</option>
                                    <option value="ç¶²ç«™ç¶²åŸŸåç¨±è²»">ç¶²ç«™ç¶²åŸŸåç¨±è²» (Domain/Web Fees)</option>
                                </optgroup>

                                <!-- ğŸ“ˆ è¡ŒéŠ·èˆ‡æ¥­å‹™è²» (Marketing & Sales) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ“ˆ è¡ŒéŠ·èˆ‡æ¥­å‹™è²» (Marketing & Sales)">
                                    <option value="å»£å‘Šèˆ‡å®£å‚³è²»">å»£å‘Šèˆ‡å®£å‚³è²» (Advertising)</option>
                                    <option value="æ¥­å‹™äº¤éš›è²»">æ¥­å‹™äº¤éš›è²» (Sales Relations)</option>
                                    <option value="å±•è¦½è²»">å±•è¦½è²» (Exhibition Fees)</option>
                                    <option value="å°åˆ·å®£å‚³å“">å°åˆ·å®£å‚³å“ (Printed Materials)</option>
                                    <option value="å¸‚å ´èª¿ç ”è²»">å¸‚å ´èª¿ç ”è²» (Market Research)</option>
                                </optgroup>
                                
                                <!-- ğŸ“š åŸ¹è¨“èˆ‡äººæ‰è²» (Training & HR) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ“š åŸ¹è¨“èˆ‡äººæ‰è²» (Training & HR)">
                                    <option value="å°ˆæ¥­åŸ¹è¨“è²»">å°ˆæ¥­åŸ¹è¨“è²» (Professional Training)</option>
                                    <option value="æ‹›å‹Ÿè²»ç”¨">æ‹›å‹Ÿè²»ç”¨ (Recruitment Costs)</option>
                                    <option value="æ•™è‚²è¨“ç·´èª²ç¨‹è²»">æ•™è‚²è¨“ç·´èª²ç¨‹è²» (Course Fees)</option>
                                    <option value="å“¡å·¥å¥åº·æª¢æŸ¥è²»">å“¡å·¥å¥åº·æª¢æŸ¥è²» (Health Check-ups)</option>
                                </optgroup>

                                <!-- ğŸ§‘â€ğŸ’» å°ˆæ¥­æœå‹™è²» (Professional Services) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ§‘â€ğŸ’» å°ˆæ¥­æœå‹™è²» (Professional Services)">
                                    <option value="é¡§å•è²»">é¡§å•è²» (Consulting)</option>
                                    <option value="æ³•å¾‹åŠæœƒè¨ˆè²»ç”¨">æ³•å¾‹åŠæœƒè¨ˆè²»ç”¨ (Legal & Accounting)</option>
                                    <option value="å¤–éƒ¨å¯©è¨ˆè²»">å¤–éƒ¨å¯©è¨ˆè²» (External Audit)</option>
                                    <option value="ç¿»è­¯/å£è­¯è²»">ç¿»è­¯/å£è­¯è²» (Translation/Interpreting)</option>
                                </optgroup>
                                
                                <!-- ğŸ¦ è²¡å‹™èˆ‡é›œé …è²» (Financial & Misc.) - å¢åŠ ç´°é … -->
                                <optgroup label="ğŸ¦ è²¡å‹™èˆ‡é›œé …è²» (Financial & Misc.)">
                                    <option value="éŠ€è¡Œæ‰‹çºŒè²»">éŠ€è¡Œæ‰‹çºŒè²» (Bank Charges)</option>
                                    <option value="åˆ©æ¯æ”¯å‡º">åˆ©æ¯æ”¯å‡º (Interest Expense)</option>
                                    <option value="æ”¿åºœè¦è²»èˆ‡ç½°é°">æ”¿åºœè¦è²»èˆ‡ç½°é° (Fees & Penalties)</option>
                                    <option value="ä¿éšªè²»">ä¿éšªè²» (Insurance Premiums)</option>
                                    <option value="æ…ˆå–„æè´ˆ">æ…ˆå–„æè´ˆ (Donations)</option>
                                </optgroup>

                                <!-- â“ å…¶ä»–é›œé …è²»ç”¨ (Miscellaneous) -->
                                <optgroup label="â“ å…¶ä»–é›œé …è²»ç”¨ (Miscellaneous)">
                                    <option value="å…¶ä»–é›œé …è²»ç”¨">å…¶ä»–é›œé …è²»ç”¨ (Misc. Other)</option>
                                </optgroup>
                            </select>
                        </div>

                        <div>
                            <label for="amount" class="block text-sm font-medium text-gray-700">é‡‘é¡ (å¿…å¡«)</label>
                            <input type="number" id="amount" placeholder="ä¾‹å¦‚ï¼š1500.50" required min="0.01" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        </div>
                        
                        <div>
                            <label for="date" class="block text-sm font-medium text-gray-700">ç™¼ç”Ÿæ—¥æœŸ (å¿…å¡«)</label>
                            <input type="date" id="date" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        </div>
                        
                        <button type="submit" id="submit-button" class="w-full flex justify-center items-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                            <span class="material-icons mr-1 text-base">send</span> æäº¤å ±éŠ·
                        </button>
                        <p id="submission-message" class="text-sm text-center mt-2 hidden"></p>
                    </form>
                </div>

                <!-- å ±éŠ·å–®åˆ—è¡¨å€ (æ ¹æ“šè§’è‰²èª¿æ•´å¯¬åº¦) -->
                <div id="list-area" class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="list-title" class="text-xl font-semibold text-green-700 flex items-center">
                            <span class="material-icons mr-2 text-2xl">list_alt</span> å¾…è™•ç†èˆ‡æ­·å²å ±éŠ·å–®
                        </h2>
                        <!-- éæ¿¾å™¨ (åªåœ¨å¯©æ‰¹è€…è§’è‰²é¡¯ç¤º) -->
                        <select id="status-filter" onchange="displayReports()" class="hidden bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 p-2.5">
                            <option value="all">æ‰€æœ‰å–®æ“š</option>
                            <option value="å¾…å¯©æ‰¹">åªçœ‹å¾…å¯©æ‰¹</option>
                            <option value="å·²æ‰¹å‡†">åªçœ‹å·²æ‰¹å‡†</option>
                            <option value="å·²æ‹’çµ•">åªçœ‹å·²æ‹’çµ•</option>
                        </select>
                    </div>
                    
                    <!-- æ–°å¢ï¼šç¸½é‡‘é¡é¡¯ç¤ºå€ -->
                    <div id="total-amount-box" class="hidden mb-4 bg-gray-50 border-t border-b border-indigo-200 p-3 rounded-lg text-sm">
                        ç•¶å‰åˆ—è¡¨ç¸½é‡‘é¡: <span id="total-amount-display" class="font-extrabold text-lg text-indigo-700 ml-1">---</span> TWD
                    </div>
                    
                    <div class="max-h-[60vh] overflow-y-auto scrollable-list">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¥æœŸ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">èªªæ˜/ç§‘ç›®</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¡ (TWD)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                                    <th id="action-header" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="reports-list" class="bg-white divide-y divide-gray-200">
                                <!-- å ±éŠ·å–®åˆ—è¡¨å°‡ç”± JavaScript åŠ è¼‰åˆ°é€™è£¡ -->
                                <tr><td colspan="5" class="text-center py-4 text-gray-500">æ­£åœ¨åŠ è¼‰å ±éŠ·å–®...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æœƒè¨ˆç§‘ç›®åˆ†æå„€è¡¨æ¿ (Analysis View) -->
        <div id="analysis-panel" class="hidden">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center">
                    <span class="material-icons mr-2 text-2xl">analytics</span> è²»ç”¨ç§‘ç›®ä½”æ¯”åˆ†æ (å·²æ‰¹å‡†å–®æ“š)
                </h2>
                <div class="text-sm text-gray-600 mb-6 border-b pb-4">
                    <span class="font-bold text-base text-red-600">* å ±è¡¨åƒ…ç´å…¥ç‹€æ…‹ç‚ºã€Œå·²æ‰¹å‡†ã€çš„è²»ç”¨å–®æ“šï¼Œä»¥åæ˜ å¯¦éš›æ”¯å‡ºã€‚</span>
                </div>

                <!-- çµ±è¨ˆç¸½è¦½å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                        <p class="text-sm font-medium text-indigo-600">å·²æ‰¹å‡†å–®æ“šç¸½æ•¸</p>
                        <p id="stat-count" class="text-2xl font-extrabold text-indigo-800 mt-1">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <p class="text-sm font-medium text-green-600">å·²æ‰¹å‡†ç¸½é‡‘é¡ (TWD)</p>
                        <p id="stat-total" class="text-2xl font-extrabold text-green-800 mt-1">0.00</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <p class="text-sm font-medium text-yellow-600">æœ€é«˜è²»ç”¨ç§‘ç›®</p>
                        <p id="stat-top-category" class="text-2xl font-extrabold text-yellow-800 mt-1 truncate">N/A</p>
                    </div>
                </div>

                <!-- D3.js é•·æ¢åœ–å®¹å™¨ -->
                <h3 class="text-lg font-semibold text-gray-800 mb-4 border-t pt-4">å„ç§‘ç›®æ”¯å‡ºæ˜ç´°</h3>
                <div id="chart-area">
                    <div id="bar-chart-container">
                        <!-- D3 SVG åœ–è¡¨å°‡æ¸²æŸ“åœ¨é€™è£¡ -->
                    </div>
                </div>
                
                <div id="chart-no-data" class="hidden text-center py-10 text-gray-500">
                    <span class="material-icons text-4xl mb-2">info</span>
                    <p>ç›®å‰æ²’æœ‰ä»»ä½•ã€Œå·²æ‰¹å‡†ã€çš„å ±éŠ·å–®æ•¸æ“šå¯ä¾›åˆ†æã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ“¬é›»å­éƒµä»¶é€šçŸ¥æ¡† (ä½¿ç”¨è‡ªè¨‚ CSS é¡ä¾†æ§åˆ¶éš±è—/é¡¯ç¤º) -->
    <div id="email-notification-box" 
        class="notification-hidden 
               fixed bottom-4 right-4 max-w-sm w-full bg-white shadow-xl 
               rounded-lg p-4 transition-all duration-500 ease-in-out border-l-4 border-indigo-500 z-50">
        <div class="flex items-start space-x-4">
            <span class="material-icons text-indigo-500 text-2xl mt-1">mail_outline</span>
            <div>
                <p class="text-sm font-semibold text-gray-900 flex items-center">
                    <span id="notification-icon" class="material-icons text-green-500 mr-1 text-base"></span>
                    <span id="notification-subject">æ¨¡æ“¬éƒµä»¶é€šçŸ¥</span>
                </p>
                <p id="notification-body" class="text-xs text-gray-500 mt-1">
                    [æ­¤ç‚ºæ¨¡æ“¬] å ±éŠ·å–®ç‹€æ…‹å·²è®Šæ›´ï¼Œè«‹å‰å¾€ç³»çµ±æŸ¥çœ‹ã€‚
                </p>
            </div>
        </div>
    </div>
    
    <!-- è²»ç”¨è©³æƒ…æ¨¡æ…‹æ¡† (Modal - ä¿æŒä¸è®Š) -->
    <div id="detail-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg transition-all transform duration-300 scale-100">
            <!-- Modal Header -->
            <div class="p-5 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-indigo-700">å ±éŠ·å–®è©³ç´°è³‡è¨Š</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition">
                    <span class="material-icons">close</span>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 space-y-4 text-sm">
                <!-- ID/åŸºæœ¬è³‡è¨Š -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-gray-500 font-medium">å ±éŠ·å–® ID:</p>
                        <p id="detail-id" class="font-mono text-gray-800">---</p>
                    </div>
                    <div>
                        <p class="text-gray-500 font-medium">ç‹€æ…‹:</p>
                        <p id="detail-status" class="font-bold text-lg">---</p>
                    </div>
                </div>

                <!-- æ ¸å¿ƒæ•¸æ“š -->
                <div class="border-t pt-4">
                    <p class="text-gray-500 font-medium">è²»ç”¨èªªæ˜:</p>
                    <p id="detail-description" class="text-gray-900 font-semibold text-lg mb-2">---</p>
                    
                    <p class="text-gray-500 font-medium mt-3">æœƒè¨ˆç§‘ç›®:</p>
                    <p id="detail-category" class="text-indigo-600 font-medium">---</p>
                    
                    <p class="text-gray-500 font-medium mt-3">ç™¼ç”Ÿæ—¥æœŸ:</p>
                    <p id="detail-date" class="text-gray-700">---</p>
                </div>

                <!-- é‡‘é¡ -->
                <div class="border-t pt-4">
                    <p class="text-gray-500 font-medium">å ±éŠ·é‡‘é¡:</p>
                    <p id="detail-amount" class="text-green-600 font-extrabold text-2xl">--- TWD</p>
                </div>

                <!-- æ™‚é–“è»¸/å¯©æ‰¹ç´€éŒ„ -->
                <div class="border-t pt-4">
                    <p class="text-gray-500 font-medium mb-2">æäº¤èˆ‡å¯©æ‰¹ç´€éŒ„:</p>
                    <ul class="space-y-2">
                        <li class="flex justify-between items-start">
                            <span class="text-gray-700">æäº¤æ™‚é–“:</span>
                            <span id="detail-createdAt" class="text-gray-600 text-right">---</span>
                        </li>
                        <li id="detail-approval-row" class="hidden flex justify-between items-start">
                            <span class="text-gray-700">å¯©æ‰¹è€…:</span>
                            <span id="detail-approvedBy" class="text-gray-600 text-right">---</span>
                        </li>
                         <li id="detail-approvedAt-row" class="hidden flex justify-between items-start">
                            <span class="text-gray-700">å¯©æ‰¹æ™‚é–“:</span>
                            <span id="detail-approvedAt" class="text-gray-600 text-right">---</span>
                        </li>
                        <li id="detail-rejection-reason-row" class="hidden">
                            <span class="text-red-500 font-semibold block mt-2">æ‹’çµ•åŸå›  (æ¨¡æ“¬):</span>
                            <span id="detail-rejection-reason" class="text-red-700 italic">ç„¡æä¾›ã€‚ (æ‡‰åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­è¦æ±‚å¡«å¯«)</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Modal Footer (åƒ…å¯©æ‰¹è€…åœ¨å¾…å¯©æ‰¹ç‹€æ…‹é¡¯ç¤º) -->
            <div id="detail-action-footer" class="p-5 border-t bg-gray-50 rounded-b-xl flex justify-end space-x-3 hidden">
                <button id="modal-approve-btn" 
                        class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition duration-150 shadow-md flex items-center">
                    <span class="material-icons mr-1 text-base">done_all</span> æ‰¹å‡†
                </button>
                <button id="modal-reject-btn" 
                        class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition duration-150 shadow-md flex items-center">
                    <span class="material-icons mr-1 text-base">close</span> æ‹’çµ•
                </button>
            </div>

        </div>
    </div>


    <!-- è…³æœ¬ï¼šä½¿ç”¨æœ¬åœ°å„²å­˜ã€è§’è‰²æ¬Šé™åˆ†é›¢èˆ‡é›»å­éƒµä»¶é€šçŸ¥æ¨¡æ“¬ -->
    <script>
        // å¼•ç”¨ DOM å…ƒç´ 
        const form = document.getElementById('expense-form');
        const reportsList = document.getElementById('reports-list');
        const submissionArea = document.getElementById('submission-area');
        const listArea = document.getElementById('list-area');
        const listTitle = document.getElementById('list-title');
        const actionHeader = document.getElementById('action-header');
        const submitButton = document.getElementById('submit-button');
        const submissionMessage = document.getElementById('submission-message');

        const currentRoleDisplay = document.getElementById('current-role-display');
        const notificationBox = document.getElementById('email-notification-box');
        const statusFilter = document.getElementById('status-filter'); 
        const totalAmountBox = document.getElementById('total-amount-box');
        const totalAmountDisplay = document.getElementById('total-amount-display');

        // Modal å…ƒç´ å¼•ç”¨
        const detailModal = document.getElementById('detail-modal');
        const detailId = document.getElementById('detail-id');
        const detailStatus = document.getElementById('detail-status');
        const detailDescription = document.getElementById('detail-description');
        const detailCategory = document.getElementById('detail-category');
        const detailDate = document.getElementById('detail-date');
        const detailAmount = document.getElementById('detail-amount');
        const detailCreatedAt = document.getElementById('detail-createdAt');
        const detailApprovedBy = document.getElementById('detail-approvedBy');
        const detailApprovedAt = document.getElementById('detail-approvedAt');
        const detailRejectionReason = document.getElementById('detail-rejection-reason');
        const detailApprovalRow = document.getElementById('detail-approval-row');
        const detailApprovedAtRow = document.getElementById('detail-approvedAt-row');
        const detailRejectionReasonRow = document.getElementById('detail-rejection-reason-row');
        const detailActionFooter = document.getElementById('detail-action-footer');
        const modalApproveBtn = document.getElementById('modal-approve-btn');
        const modalRejectBtn = document.getElementById('modal-reject-btn');


        // æ–°å¢çš„è¦–åœ–å…ƒç´ å¼•ç”¨
        const dashboardPanel = document.getElementById('dashboard-panel');
        const analysisPanel = document.getElementById('analysis-panel');
        const tabDashboard = document.getElementById('tab-dashboard');
        const tabAnalysis = document.getElementById('tab-analysis');
        const chartContainer = document.getElementById('bar-chart-container');
        const chartNoData = document.getElementById('chart-no-data');

        // å ±è¡¨çµ±è¨ˆå¡ç‰‡å¼•ç”¨
        const statCount = document.getElementById('stat-count');
        const statTotal = document.getElementById('stat-total');
        const statTopCategory = document.getElementById('stat-top-category');

        // æœ¬åœ°å„²å­˜çš„éµå
        const STORAGE_KEY = 'local_expense_reports';
        // æ¨¡æ“¬ç•¶å‰ä½¿ç”¨è€…è§’è‰²
        let currentUserRole = 'submitter'; 

        // è¼”åŠ©å‡½æ•¸: æ ¼å¼åŒ–æ—¥æœŸæ™‚é–“
        function formatDateTime(isoString) {
            if (!isoString) return 'N/A';
            try {
                const date = new Date(isoString);
                return date.toLocaleString('zh-TW', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit', 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                }).replace(/\//g, '-').replace(',', ' ');
            } catch (e) {
                return isoString;
            }
        }
        
        // è¼”åŠ©å‡½æ•¸: æ ¼å¼åŒ–é‡‘é¡
        function formatAmount(amount) {
            if (isNaN(amount) || amount === null) return 'N/A';
            // ä½¿ç”¨ en-US æ ¼å¼åŒ–ä»¥ç¢ºä¿åƒåˆ†ä½å’Œå…©ä½å°æ•¸é»
            return amount.toLocaleString('en-US', { minimumFractionDigits: 2 });
        }
        
        /**
         * è¼‰å…¥å ±éŠ·å–®è³‡æ–™ï¼ˆå¾ localStorageï¼‰
         */
        function loadReports() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error("éŒ¯èª¤ï¼šç„¡æ³•å¾ localStorage è¼‰å…¥æ•¸æ“š", error);
                return [];
            }
        }

        /**
         * å„²å­˜å ±éŠ·å–®è³‡æ–™ï¼ˆåˆ° localStorageï¼‰
         */
        function saveReports(reports) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(reports));
            } catch (error) {
                console.error("åš´é‡éŒ¯èª¤ï¼šç„¡æ³•å°‡æ•¸æ“šå­˜å„²åˆ° localStorageï¼Œå¯èƒ½ç©ºé–“å·²æ»¿æˆ–å­˜å„²è¢«ç¦ç”¨ã€‚", error);
            }
        }

        /**
         * ç°¡å–®çš„ ID ç”Ÿæˆå™¨
         */
        function generateId() {
            return 'R' + Date.now().toString(36) + Math.random().toString(36).substring(2, 5);
        }

        /**
         * æ¨¡æ“¬é›»å­éƒµä»¶é€šçŸ¥åŠŸèƒ½
         */
        function simulateEmailNotification(report, newStatus) {
            if (newStatus === 'å¾…å¯©æ‰¹') { 
                // æäº¤æˆåŠŸé€šçŸ¥æäº¤è€…ï¼Œä½†é€™å€‹æ¨¡æ“¬ä¸éœ€è¦
                return; 
            }
            
            let subject = '';
            let body = '';
            let icon = 'mail_outline';

            if (newStatus === 'å·²æ‰¹å‡†') {
                subject = 'âœ… å ±éŠ·å–®å·²æ‰¹å‡†: ' + report.description;
                body = `æ‚¨çš„è²»ç”¨å ±éŠ·å–® ID: ${report.id} (é‡‘é¡: ${formatAmount(report.amount)} TWD) å·²ç”±ç¶“ç†æ‰¹å‡†ã€‚`;
                icon = 'check_circle';
            } else if (newStatus === 'å·²æ‹’çµ•') {
                subject = 'âŒ å ±éŠ·å–®è¢«æ‹’çµ•: ' + report.description;
                body = `æ‚¨çš„è²»ç”¨å ±éŠ·å–® ID: ${report.id} (é‡‘é¡: ${formatAmount(report.amount)} TWD) å·²è¢«æ‹’çµ•ã€‚è«‹ç™»å…¥ç³»çµ±æŸ¥çœ‹è©³æƒ…ã€‚`;
                icon = 'cancel';
            }

            // é¡¯ç¤ºé€šçŸ¥
            document.getElementById('notification-subject').textContent = subject;
            document.getElementById('notification-body').textContent = `[æ¨¡æ“¬é€šçŸ¥] ${body}`;
            document.getElementById('notification-icon').textContent = icon;
            document.getElementById('notification-icon').classList.remove('text-green-500', 'text-red-500');
            document.getElementById('notification-icon').classList.add(newStatus === 'å·²æ‰¹å‡†' ? 'text-green-500' : 'text-red-500');


            notificationBox.classList.remove('notification-hidden');
            notificationBox.classList.add('notification-visible');

            // 5 ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(() => {
                notificationBox.classList.remove('notification-visible');
                notificationBox.classList.add('notification-hidden');
            }, 5000);
        }

        /**
         * è™•ç†å¯©æ‰¹æ“ä½œ (æ‰¹å‡†/æ‹’çµ•)
         */
        window.handleApproval = (reportId, newStatus) => {
            if (currentUserRole !== 'approver') {
                console.error("æ¬Šé™ä¸è¶³ï¼šåªæœ‰å¯©æ‰¹è€…å¯ä»¥åŸ·è¡Œæ­¤æ“ä½œã€‚è«‹åˆ‡æ›ç‚ºå¯©æ‰¹è€…è§’è‰²ã€‚");
                return;
            }

            let reports = loadReports();
            const reportIndex = reports.findIndex(r => r.id === reportId);
            
            if (reportIndex === -1 || reports[reportIndex].status !== 'å¾…å¯©æ‰¹') { return; }
            
            try {
                const updatedReport = reports[reportIndex];
                updatedReport.status = newStatus;
                updatedReport.approvedBy = 'LocalManager'; // æ¨¡æ“¬å¯©æ‰¹è€…åç¨±
                updatedReport.approvedAt = new Date().toISOString();
                
                saveReports(reports);
                simulateEmailNotification(updatedReport, newStatus);
                
                // å¯©æ‰¹å®Œæˆå¾Œï¼Œåˆ·æ–°å„€è¡¨æ¿å’Œåˆ†æå ±è¡¨
                displayReports(); 
                if (analysisPanel.classList.contains('hidden') === false) {
                    renderAnalysis();
                }

            } catch (e) {
                console.error("å¯©æ‰¹éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", e);
            }
        };


        window.showReportDetails = (reportId) => {
            const reports = loadReports();
            const report = reports.find(r => r.id === reportId);

            if (!report) {
                console.error('å ±éŠ·å–®æœªæ‰¾åˆ°:', reportId);
                return;
            }
            
            // 1. å¡«å……åŸºæœ¬æ•¸æ“š
            detailId.textContent = report.id;
            detailDescription.textContent = report.description;
            detailCategory.textContent = report.category;
            detailDate.textContent = report.date;
            detailAmount.textContent = `${formatAmount(report.amount)} TWD`;
            detailCreatedAt.textContent = formatDateTime(report.createdAt);

            // 2. è™•ç†ç‹€æ…‹é¡è‰²
            let statusText = report.status;
            detailStatus.textContent = statusText;
            detailStatus.className = 'font-bold text-lg';
            if (statusText === 'å·²æ‰¹å‡†') detailStatus.classList.add('text-green-600');
            else if (statusText === 'å·²æ‹’çµ•') detailStatus.classList.add('text-red-600');
            else detailStatus.classList.add('text-yellow-600');
            
            // 3. è™•ç†å¯©æ‰¹/æ‹’çµ•è³‡è¨Š
            const isApprovedOrRejected = report.status === 'å·²æ‰¹å‡†' || report.status === 'å·²æ‹’çµ•';
            detailApprovalRow.classList.toggle('hidden', !isApprovedOrRejected);
            detailApprovedAtRow.classList.toggle('hidden', !isApprovedOrRejected);
            detailRejectionReasonRow.classList.toggle('hidden', report.status !== 'å·²æ‹’çµ•');

            if (isApprovedOrRejected) {
                detailApprovedBy.textContent = report.approvedBy || 'N/A';
                detailApprovedAt.textContent = formatDateTime(report.approvedAt);
            }
            
            // 4. è™•ç†æ‹’çµ•åŸå›  (æ­¤è™•æ¨¡æ“¬ï¼Œç”Ÿç”¢ç’°å¢ƒæ‡‰æœ‰æ•¸æ“š)
            if (report.status === 'å·²æ‹’çµ•') {
                 detailRejectionReason.textContent = report.rejectionReason || 'æœªæä¾›æ‹’çµ•åŸå›  (æ¨¡æ“¬)';
            }

            // 5. è™•ç†å¯©æ‰¹æ“ä½œæŒ‰éˆ• (åƒ…é™å¯©æ‰¹è€…ä¸”ç‹€æ…‹ç‚ºå¾…å¯©æ‰¹)
            const showFooter = currentUserRole === 'approver' && report.status === 'å¾…å¯©æ‰¹';
            detailActionFooter.classList.toggle('hidden', !showFooter);

            if (showFooter) {
                modalApproveBtn.onclick = () => {
                    handleApproval(report.id, 'å·²æ‰¹å‡†');
                    closeModal();
                };
                modalRejectBtn.onclick = () => {
                    // å¯¦éš›ç”Ÿç”¢ç’°å¢ƒä¸­ï¼Œé€™è£¡æœƒå½ˆå‡ºä¸€å€‹è¼¸å…¥æ‹’çµ•åŸå› çš„æç¤ºæ¡†
                    if (window.confirm("æ‚¨ç¢ºå®šè¦æ‹’çµ•é€™ç­†å ±éŠ·å–®å—ï¼Ÿ(ç”Ÿç”¢ç’°å¢ƒå°‡è¦æ±‚å¡«å¯«åŸå› )")) {
                        handleApproval(report.id, 'å·²æ‹’çµ•');
                        closeModal();
                    }
                };
            }
            
            detailModal.classList.remove('hidden');
        };
        
        window.closeModal = () => {
            detailModal.classList.add('hidden');
        };
        
        // å…è¨±æŒ‰ ESC é—œé–‰ Modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });


        /**
         * æ¸²æŸ“å ±éŠ·å–®åˆ—è¡¨ (æ ¹æ“šç•¶å‰è§’è‰²å’Œéæ¿¾å™¨èª¿æ•´)
         */
        function displayReports() {
            let reports = loadReports();
            reportsList.innerHTML = '';
            let totalAmount = 0;
            const isApprover = currentUserRole === 'approver';
            let filteredReports = reports;
            
            if (isApprover) {
                const selectedStatus = statusFilter.value;
                if (selectedStatus !== 'all') {
                    filteredReports = reports.filter(r => r.status === selectedStatus);
                }
            } else {
                 // æäº¤è€…åªèƒ½çœ‹è‡ªå·±çš„å–®æ“š (åœ¨æ¨¡æ“¬ä¸­ï¼Œæ‰€æœ‰æ•¸æ“šéƒ½å±¬æ–¼ 'LocalUser')
                 // é€™è£¡æˆ‘å€‘å‡è¨­ 'LocalUser' æ˜¯æäº¤è€…ï¼Œä¸éœ€è¦é¡å¤–éæ¿¾
            }
            
            filteredReports.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            actionHeader.style.display = isApprover ? 'table-cell' : 'none';

            if (filteredReports.length === 0) {
                const colSpan = isApprover ? 5 : 4;
                let message = 'ç›®å‰æ²’æœ‰å ±éŠ·å–®è¨˜éŒ„ã€‚';
                if (isApprover && statusFilter.value !== 'all') {
                     message = `æ²’æœ‰æ‰¾åˆ°ç‹€æ…‹ç‚º "${statusFilter.value}" çš„å–®æ“šã€‚`;
                }
                reportsList.innerHTML = `<tr><td colspan="${colSpan}" class="text-center py-4 text-gray-500">${message}</td></tr>`;
                
                if (isApprover) {
                    totalAmountBox.classList.remove('hidden');
                    totalAmountDisplay.textContent = '0.00';
                }
                return;
            }

            // éæ­·å ±å‘Šä¸¦æ¸²æŸ“ï¼ŒåŒæ™‚è¨ˆç®—ç¸½é‡‘é¡
            filteredReports.forEach(report => {
                totalAmount += report.amount; // ç´¯åŠ é‡‘é¡
                
                let statusColor, statusIcon;
                switch (report.status) {
                    case 'å·²æ‰¹å‡†':
                        statusColor = 'bg-green-100 text-green-800';
                        statusIcon = 'check_circle';
                        break;
                    case 'å·²æ‹’çµ•':
                        statusColor = 'bg-red-100 text-red-800';
                        statusIcon = 'cancel';
                        break;
                    case 'å¾…å¯©æ‰¹':
                    default:
                        statusColor = 'bg-yellow-100 text-yellow-800';
                        statusIcon = 'schedule';
                        break;
                }
                
                const reportDate = report.date ? report.date : 'N/A';
                
                let actionButtonsHTML = '';
                let tdActionClass = 'px-6 py-4 whitespace-nowrap text-right text-sm font-medium';

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-100 transition duration-100 cursor-pointer'; 
                row.onclick = (e) => {
                    // é»æ“Šè¡Œæ™‚ï¼Œå¦‚æœä¸æ˜¯é»æ“ŠæŒ‰éˆ•ï¼Œå‰‡é¡¯ç¤ºè©³æƒ…
                    if (!e.target.closest('button')) { 
                        showReportDetails(report.id);
                    }
                }; 

                if (isApprover) {
                    // å¯©æ‰¹è€…é¡¯ç¤ºæ“ä½œæŒ‰éˆ•å’Œè©³æƒ…æŒ‰éˆ•
                    actionButtonsHTML = `
                         <button onclick="event.stopPropagation(); showReportDetails('${report.id}')" 
                            class="text-indigo-600 hover:text-indigo-900 transition duration-150 p-1 rounded-full hover:bg-indigo-100"
                            title="æŸ¥çœ‹è©³æƒ…/å¯©æ‰¹"
                        >
                            <span class="material-icons text-base align-middle">visibility</span>
                        </button>
                    `;
                } else {
                    // æäº¤è€…ä¸é¡¯ç¤ºæ“ä½œæ¬„ï¼Œé»æ“Šæ•´è¡ŒæŸ¥çœ‹è©³æƒ…
                    tdActionClass = 'hidden'; 
                }

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${reportDate}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${report.description}
                        <!-- å¼·åŒ–ç§‘ç›®é¡¯ç¤ºæ•ˆæœ -->
                        <div class="text-xs text-indigo-700 font-semibold mt-1 bg-indigo-50 px-2 py-0.5 rounded-full inline-block">
                             ${report.category || 'N/A'}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">
                        $${formatAmount(report.amount)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                            <span class="material-icons text-sm mr-1 align-middle">${statusIcon}</span> ${report.status}
                        </span>
                    </td>
                    <td class="${tdActionClass} ${isApprover ? '' : 'hidden'} text-center">
                        ${actionButtonsHTML}
                    </td>
                `;
                reportsList.appendChild(row);
            });
            
            // æ›´æ–°ç¸½é‡‘é¡é¡¯ç¤º
            if (isApprover) {
                totalAmountBox.classList.remove('hidden');
                totalAmountDisplay.textContent = formatAmount(totalAmount);
            } else {
                totalAmountBox.classList.add('hidden');
            }
        }
        
        /**
         * è™•ç†è¡¨å–®æäº¤é‚è¼¯
         */
        function setupFormSubmission() {
            form.onsubmit = (e) => {
                e.preventDefault();
                
                if (currentUserRole !== 'submitter') {
                    submissionMessage.textContent = 'âŒ éŒ¯èª¤ï¼šåªæœ‰æäº¤è€…è§’è‰²å¯ä»¥æäº¤å ±éŠ·å–®ã€‚';
                    submissionMessage.classList.remove('hidden', 'text-green-600');
                    submissionMessage.classList.add('text-red-600');
                    return;
                }
                
                submitButton.disabled = true;
                submitButton.textContent = 'æäº¤ä¸­...';

                const description = document.getElementById('description').value;
                const amountInput = document.getElementById('amount').value;
                const amount = parseFloat(parseFloat(amountInput).toFixed(2));
                const date = document.getElementById('date').value;
                const category = document.getElementById('category').value;
                
                if (!description || isNaN(amount) || amount <= 0 || !date || !category) {
                    submissionMessage.textContent = 'âŒ éŒ¯èª¤ï¼šæ‰€æœ‰æ¬„ä½éƒ½å¿…é ˆæ­£ç¢ºå¡«å¯«ã€‚';
                    submissionMessage.classList.remove('hidden', 'text-green-600');
                    submissionMessage.classList.add('text-red-600');
                    submitButton.disabled = false;
                    submitButton.innerHTML = `<span class="material-icons mr-1 text-base">send</span> æäº¤å ±éŠ·`;
                    return;
                }

                const newReport = {
                    id: generateId(),
                    submitterId: 'LocalUser',
                    description: description,
                    category: category,
                    amount: amount,
                    date: date,
                    status: 'å¾…å¯©æ‰¹',
                    createdAt: new Date().toISOString(),
                };

                try {
                    const reports = loadReports();
                    reports.push(newReport);
                    saveReports(reports);
                    
                    submissionMessage.textContent = 'âœ… å ±éŠ·å–®æäº¤æˆåŠŸï¼ç­‰å¾…å¯©æ‰¹ã€‚';
                    submissionMessage.classList.remove('hidden', 'text-red-600');
                    submissionMessage.classList.add('text-green-600');
                    
                    form.reset();
                    displayReports(); // åˆ·æ–°åˆ—è¡¨
                    
                    console.log(`%c[System Alert] New Expense Report Submitted: ${newReport.description}. Manager needs review.`, 'color: orange;');
                    
                    setTimeout(() => { submissionMessage.classList.add('hidden'); }, 3000);

                } catch (e) {
                    console.error("æäº¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", e);
                    submissionMessage.textContent = `âŒ æäº¤å¤±æ•—: ${e.message}`;
                    submissionMessage.classList.remove('hidden', 'text-green-600');
                    submissionMessage.classList.add('text-red-600');
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = `<span class="material-icons mr-1 text-base">send</span> æäº¤å ±éŠ·`;
                }
            };
        }
        
        // --- D3.js å ±è¡¨åˆ†ææ ¸å¿ƒåŠŸèƒ½ (èˆ‡ä¸Šæ¬¡æäº¤ä¿æŒä¸€è‡´) ---

        /**
         * åŸ·è¡Œæ•¸æ“šèšåˆå’Œæ¸²æŸ“é•·æ¢åœ–
         */
        function renderAnalysis() {
            // 1. æ•¸æ“šæº–å‚™: åƒ…ç¯©é¸ã€Œå·²æ‰¹å‡†ã€çš„å–®æ“š
            const reports = loadReports();
            const approvedReports = reports.filter(r => r.status === 'å·²æ‰¹å‡†');

            // 2. æ•¸æ“šèšåˆ: æŒ‰ 'category' åˆ†çµ„ä¸¦åŠ ç¸½ 'amount'
            const aggregatedDataMap = approvedReports.reduce((acc, report) => {
                const category = report.category || 'æœªåˆ†é¡ç§‘ç›®';
                acc[category] = (acc[category] || 0) + report.amount;
                return acc;
            }, {});

            // è½‰æ›ç‚º D3 æ˜“è™•ç†çš„é™£åˆ—æ ¼å¼
            let data = Object.keys(aggregatedDataMap).map(key => ({
                category: key,
                total: aggregatedDataMap[key]
            }));

            // 3. è™•ç†ç„¡æ•¸æ“šæƒ…æ³
            if (data.length === 0) {
                chartNoData.classList.remove('hidden');
                d3.select("#bar-chart-container").select("svg").remove();
                statCount.textContent = '0';
                statTotal.textContent = '0.00';
                statTopCategory.textContent = 'N/A';
                return;
            }

            chartNoData.classList.add('hidden');

            // 4. æ›´æ–°çµ±è¨ˆå¡ç‰‡
            const totalApprovedAmount = data.reduce((sum, item) => sum + item.total, 0);
            const topCategory = data.reduce((max, item) => item.total > max.total ? item : max, { total: -1, category: 'N/A' });
            
            statCount.textContent = approvedReports.length.toString();
            statTotal.textContent = formatAmount(totalApprovedAmount);
            statTopCategory.textContent = topCategory.category;


            // 5. æ’åºæ•¸æ“š (ç¸½é‡‘é¡é™åº)
            data.sort((a, b) => b.total - a.total);

            // 6. D3.js é•·æ¢åœ–æ¸²æŸ“

            // æ¸…ç©ºèˆŠåœ–è¡¨
            d3.select("#bar-chart-container").select("svg").remove();

            // å®šç¾©å°ºå¯¸
            const margin = { top: 30, right: 20, bottom: 150, left: 80 }; // å¢åŠ åº•éƒ¨å’Œå·¦å´é‚Šè·
            const width = chartContainer.clientWidth - margin.left - margin.right;
            const height = chartContainer.clientHeight - margin.top - margin.bottom;

            // å‰µå»º SVG å®¹å™¨
            const svg = d3.select("#bar-chart-container")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // 7. å®šç¾©æ¯”ä¾‹å°º (Scale)
            
            // X è»¸ï¼šåºæ•¸æ¯”ä¾‹å°º (Ordinal Scale) for Categories
            const x = d3.scaleBand()
                .domain(data.map(d => d.category))
                .range([0, width])
                .padding(0.3);

            // Y è»¸ï¼šç·šæ€§æ¯”ä¾‹å°º (Linear Scale) for Amount
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.total) * 1.1]) // Yè»¸æœ€å¤§å€¼ç‚ºæ•¸æ“šæœ€å¤§å€¼çš„ 110%
                .range([height, 0]);

            // 8. ç¹ªè£½è»¸ç·š (Axes)
            
            // X è»¸
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)") // æ—‹è½‰æ¨™ç±¤ä»¥ç¯€çœç©ºé–“
                .style("text-anchor", "end")
                .style("font-size", "12px");

            // Y è»¸
            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => formatAmount(d))) // Yè»¸æ•¸å€¼æ ¼å¼åŒ–
                .style("font-size", "12px")
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 15)
                .attr("x", -height / 2)
                .attr("fill", "#000")
                .style("text-anchor", "middle")
                .style("font-size", "14px")
                .text("ç¸½æ”¯å‡ºé‡‘é¡ (TWD)");


            // 9. ç¹ªè£½é•·æ¢ (Bars)
            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.category))
                .attr("y", d => y(d.total))
                .attr("width", x.bandwidth())
                .attr("height", d => height - y(d.total));

            // 10. ç¹ªè£½é•·æ¢ä¸Šæ–¹çš„æ•¸å€¼æ¨™ç±¤
            svg.selectAll(".label")
                .data(data)
                .enter().append("text")
                .attr("class", "label")
                .attr("x", d => x(d.category) + x.bandwidth() / 2)
                .attr("y", d => y(d.total) - 5)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .text(d => `$${formatAmount(d.total)}`);
        }

        // --- è¦–åœ–åˆ‡æ›é‚è¼¯ (èˆ‡ä¸Šæ¬¡æäº¤ä¿æŒä¸€è‡´) ---

        /**
         * åˆ‡æ›ä¸»è¦–åœ– (å ±éŠ·/åˆ†æ)
         */
        window.switchView = (view) => {
            if (view === 'dashboard') {
                dashboardPanel.classList.remove('hidden');
                analysisPanel.classList.add('hidden');
                tabDashboard.classList.add('border-indigo-600', 'text-indigo-600');
                tabDashboard.classList.remove('border-transparent', 'text-gray-500', 'hover:border-gray-400', 'hover:text-gray-700');
                tabAnalysis.classList.remove('border-indigo-600', 'text-indigo-600');
                tabAnalysis.classList.add('border-transparent', 'text-gray-500', 'hover:border-gray-400', 'hover:text-gray-700');
                displayReports(); // åˆ‡å›å„€è¡¨æ¿æ™‚åˆ·æ–°åˆ—è¡¨
            } else if (view === 'analysis') {
                dashboardPanel.classList.add('hidden');
                analysisPanel.classList.remove('hidden');
                tabAnalysis.classList.add('border-indigo-600', 'text-indigo-600');
                tabAnalysis.classList.remove('border-transparent', 'text-gray-500', 'hover:border-gray-400', 'hover:text-gray-700');
                tabDashboard.classList.remove('border-indigo-600', 'text-indigo-600');
                tabDashboard.classList.add('border-transparent', 'text-gray-500', 'hover:border-gray-400', 'hover:text-gray-700');
                renderAnalysis(); // åˆ‡æ›åˆ°åˆ†æè¦–åœ–æ™‚æ¸²æŸ“åœ–è¡¨
            }
        }
        
        // ç›£è½çª—å£å¤§å°è®ŠåŒ–äº‹ä»¶ï¼Œé‡æ–°æ¸²æŸ“åœ–è¡¨ä»¥ç¢ºä¿éŸ¿æ‡‰æ€§
        window.addEventListener('resize', () => {
             // åªæœ‰åœ¨ Analysis è¦–åœ–ä¸‹æ‰é‡ç¹ª
            if (analysisPanel.classList.contains('hidden') === false) {
                renderAnalysis();
            }
        });

        /**
         * æ ¹æ“šè§’è‰²æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼ä»‹é¢ (èˆ‡ä¸Šæ¬¡æäº¤ä¿æŒä¸€è‡´)
         */
        window.switchRole = (role) => {
            currentUserRole = role;
            
            // 1. æ›´æ–°è§’è‰²é¡¯ç¤º
            if (role === 'submitter') {
                currentRoleDisplay.textContent = 'æäº¤è€… (å“¡å·¥)';
                currentRoleDisplay.classList.remove('text-green-700');
                currentRoleDisplay.classList.add('text-indigo-700');
                submissionArea.classList.remove('hidden');
                listArea.classList.remove('lg:col-span-3');
                listArea.classList.add('lg:col-span-2');
                listTitle.innerHTML = `<span class="material-icons mr-2 text-2xl">list_alt</span> æˆ‘æäº¤çš„å ±éŠ·å–®`;
                statusFilter.classList.add('hidden');
            } else if (role === 'approver') {
                currentRoleDisplay.textContent = 'å¯©æ‰¹è€… (ç¶“ç†)';
                currentRoleDisplay.classList.remove('text-indigo-700');
                currentRoleDisplay.classList.add('text-green-700');
                submissionArea.classList.add('hidden');
                listArea.classList.remove('lg:col-span-2');
                listArea.classList.add('lg:col-span-3');
                listTitle.innerHTML = `<span class="material-icons mr-2 text-2xl">list_alt</span> æ‰€æœ‰å¾…å¯©æ‰¹èˆ‡æ­·å²å–®æ“š`;
                statusFilter.classList.remove('hidden');
            }
            
            // 2. åªæœ‰åœ¨ Dashboard è¦–åœ–ä¸‹æ‰åŸ·è¡Œ displayReports
            if (dashboardPanel.classList.contains('hidden') === false) {
                 displayReports(); 
            }
            // 3. å¦‚æœåœ¨ Analysis è¦–åœ–ï¼Œå‰‡é‡æ–°æ¸²æŸ“åˆ†æ
            if (analysisPanel.classList.contains('hidden') === false) {
                renderAnalysis();
            }
        };


        /**
         * å•Ÿå‹•æ™‚æ³¨å…¥æ¨¡æ“¬æ•¸æ“š (å¦‚æœæœ¬åœ°å„²å­˜ä¸­æ²’æœ‰æ•¸æ“š)
         * èª¿æ•´äº†æ¨¡æ“¬æ•¸æ“šï¼ŒåŠ å…¥äº†æ–°çš„ç§‘ç›®ã€‚
         */
        function injectMockData() {
            const reports = loadReports();
            if (reports.length === 0) {
                console.log("æœ¬åœ°å„²å­˜ç‚ºç©ºï¼Œæ³¨å…¥æ¨¡æ“¬æ•¸æ“šã€‚");
                const today = new Date().toISOString().slice(0, 10);
                const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
                const twoDaysAgo = new Date(Date.now() - 86400000 * 2).toISOString().slice(0, 10);
                const lastWeek = new Date(Date.now() - 86400000 * 7).toISOString().slice(0, 10);

                const mockData = [
                    {
                        id: 'R' + Date.now().toString(36) + '001',
                        submitterId: 'LocalUser',
                        description: 'å°ˆæ¡ˆå•Ÿå‹•æœƒè­°é¤è²»',
                        category: 'å®¢æˆ¶æ‹›å¾…è²»',
                        amount: 3200.00,
                        date: today,
                        status: 'å¾…å¯©æ‰¹',
                        createdAt: new Date().toISOString(),
                    },
                    {
                        id: 'R' + Date.now().toString(36) + '002',
                        submitterId: 'LocalUser',
                        description: 'å‰å¾€é«˜é›„å‡ºå·®é«˜éµç¥¨',
                        category: 'åœ‹å…§å·®æ—…è²»',
                        amount: 1490.50,
                        date: yesterday,
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 3600000).toISOString(), 
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 1800000).toISOString(),
                    },
                    {
                        id: 'R' + Date.now().toString(36) + '003',
                        submitterId: 'LocalUser',
                        description: 'æ–°å°è¡¨æ©Ÿå¢¨æ°´åŒ£æ¡è³¼',
                        category: 'è¾¦å…¬ç”¨å“åŠè€—æ',
                        amount: 880.00,
                        date: yesterday,
                        status: 'å¾…å¯©æ‰¹',
                        createdAt: new Date(Date.now() - 7200000).toISOString(), 
                    },
                    {
                        id: 'R' + Date.now().toString(36) + '004',
                        submitterId: 'LocalUser',
                        description: 'å®¢æˆ¶æ„Ÿè¬ç¦®ç‰©',
                        category: 'æ¥­å‹™äº¤éš›è²»',
                        amount: 2500.00,
                        date: twoDaysAgo, 
                        status: 'å·²æ‹’çµ•',
                        createdAt: new Date(Date.now() - 86400000 * 2).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 1.5).toISOString(),
                    },
                    // æ–°å¢æ›´å¤šã€Œå·²æ‰¹å‡†ã€æ•¸æ“šç”¨æ–¼åˆ†æ
                    {
                        id: 'R' + Date.now().toString(36) + '005',
                        submitterId: 'LocalUser',
                        description: 'Google å»£å‘ŠæŠ•æ”¾è²»',
                        category: 'å»£å‘Šèˆ‡å®£å‚³è²»',
                        amount: 8000.00,
                        date: lastWeek, 
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 86400000 * 7).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 6.5).toISOString(),
                    },
                    {
                        id: 'R' + Date.now().toString(36) + '006',
                        submitterId: 'LocalUser',
                        description: 'æ³•å¾‹é¡§å•æœˆè²»',
                        category: 'æ³•å¾‹åŠæœƒè¨ˆè²»ç”¨',
                        amount: 12000.00,
                        date: lastWeek, 
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 86400000 * 5).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 4.5).toISOString(),
                    },
                    {
                        id: 'R' + Date.now().toString(36) + '007',
                        submitterId: 'LocalUser',
                        description: 'éƒ¨é–€èšé¤è²»ç”¨',
                        category: 'å“¡å·¥ç¦åˆ©é¤è²»',
                        amount: 4500.00,
                        date: twoDaysAgo, 
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 86400000 * 3).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 2.5).toISOString(),
                    },
                    {
                        id: 'R' + Date.now().toString(36) + '008',
                        submitterId: 'LocalUser',
                        description: 'å°åŒ—è¾¦å…¬å®¤æœˆç§Ÿ',
                        category: 'ç§Ÿé‡‘æ”¯å‡º',
                        amount: 50000.00,
                        date: today, 
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 86400000 * 0.5).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 0.25).toISOString(),
                    },
                    // ä½¿ç”¨æ–°å¢çš„ç§‘ç›®
                     {
                        id: 'R' + Date.now().toString(36) + '009',
                        submitterId: 'LocalUser',
                        description: 'AWS é›²æœå‹™è²»ç”¨',
                        category: 'è»Ÿé«”è¨‚é–±è²»',
                        amount: 7200.00,
                        date: twoDaysAgo, 
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 86400000 * 3.5).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 3.1).toISOString(),
                    },
                     {
                        id: 'R' + Date.now().toString(36) + '010',
                        submitterId: 'LocalUser',
                        description: 'æ–°å“¡å·¥è·å‰åŸ¹è¨“èª²ç¨‹',
                        category: 'å°ˆæ¥­åŸ¹è¨“è²»',
                        amount: 6000.00,
                        date: lastWeek, 
                        status: 'å·²æ‰¹å‡†',
                        createdAt: new Date(Date.now() - 86400000 * 8).toISOString(),
                        approvedBy: 'LocalManager',
                        approvedAt: new Date(Date.now() - 86400000 * 7.5).toISOString(),
                    },
                ];
                saveReports(mockData);
            }
        }

        // æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•
        document.addEventListener('DOMContentLoaded', () => {
            injectMockData(); // æ³¨å…¥æ•¸æ“š
            setupFormSubmission();
            // é è¨­åˆ‡æ›åˆ° Dashboard è¦–åœ–
            switchView('dashboard'); 
            // é è¨­ç‚ºæäº¤è€…è¦–è§’
            switchRole('submitter'); 
        });
    </script>
</body>
</html>
